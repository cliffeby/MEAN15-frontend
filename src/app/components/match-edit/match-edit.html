<form [formGroup]="matchForm" (ngSubmit)="submit()" class="match-edit">
  <h2>Edit Match</h2>

  <mat-form-field appearance="fill">
    <mat-label>Match Name</mat-label>
    <input matInput formControlName="name" required placeholder="Enter match name" title="Match Name" />
    <mat-error *ngIf="matchForm.get('name')?.hasError('required')">
      Match name is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Scorecard</mat-label>
    <mat-select formControlName="scorecardId" placeholder="Select a scorecard" (selectionChange)="onScorecardChange($event.value)">
      <mat-option value="">None</mat-option>
      <mat-option *ngFor="let scorecard of scorecards$ | async" [value]="scorecard._id">
        {{ scorecard.name || scorecard.groupName || 'Unnamed Scorecard' }}
        <span *ngIf="scorecard.rating"> - Rating: {{ scorecard.rating }}</span>
        <span *ngIf="scorecard.slope"> - Slope: {{ scorecard.slope }}</span>
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Course/Group Name</mat-label>
    <input matInput formControlName="scGroupName" placeholder="Enter course or group name" title="Course Name" />
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Number of Players</mat-label>
    <input matInput formControlName="players" type="number" min="1" max="144" placeholder="Enter number of players" title="Players" />
    <mat-error *ngIf="matchForm.get('players')?.hasError('min')">
      Must be at least 1 player
    </mat-error>
    <mat-error *ngIf="matchForm.get('players')?.hasError('max')">
      Cannot exceed 144 players
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Status</mat-label>
    <mat-select formControlName="status" required>
      <mat-option *ngFor="let status of statusOptions" [value]="status.value">
        {{ status.label }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="matchForm.get('status')?.hasError('required')">
      Status is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Date Played</mat-label>
    <input matInput [matDatepicker]="picker" formControlName="datePlayed" placeholder="Select date played" title="Date Played" />
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    <mat-error *ngIf="matchForm.get('datePlayed')?.hasError('required')">
      Date played is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>User</mat-label>
    <input matInput formControlName="user" required placeholder="Enter user" title="User" />
    <mat-error *ngIf="matchForm.get('user')?.hasError('required')">
      User is required
    </mat-error>
  </mat-form-field>

  <div class="button-group">
    <button mat-raised-button color="primary" type="submit" [disabled]="(loading$ | async) || matchForm.invalid">
      {{ (loading$ | async) ? 'Updating...' : 'Update Match' }}
    </button>
    <button mat-button type="button" (click)="cancel()">Cancel</button>
  </div>
</form>