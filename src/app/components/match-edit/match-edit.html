<form [formGroup]="matchForm" (ngSubmit)="submit()" class="match-edit">
  <h2>Edit Match</h2>
  
  <!-- Debug info - remove this after fixing -->
  <div class="debug-info">
    <strong>Debug Info:</strong><br>
    Scorecards loaded: {{ scorecards.length }}<br>
    <span *ngIf="scorecards.length === 0">
      No scorecards found - check console for loading errors
    </span>
  </div>

  <mat-form-field appearance="fill">
    <mat-label>Match Name</mat-label>
    <input matInput formControlName="name" required placeholder="Enter match name" title="Match Name" />
    <mat-error *ngIf="matchForm.get('name')?.hasError('required')">
      Match name is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Scorecard</mat-label>
    <mat-select formControlName="scorecardId" placeholder="Select a scorecard" (selectionChange)="onScorecardChange($event.value)" [compareWith]="compareScorecardsById">
      <mat-option value="">None</mat-option>
      <mat-option *ngFor="let scorecard of scorecards" [value]="scorecard._id">
        {{ scorecard.name || scorecard.groupName || 'Unnamed Scorecard' }}
        <span *ngIf="scorecard.rating"> - Rating: {{ scorecard.rating }}</span>
        <span *ngIf="scorecard.slope"> - Slope: {{ scorecard.slope }}</span>
      </mat-option>
    </mat-select>
    <mat-error *ngIf="matchForm.get('scorecardId')?.hasError('required')">
      Scorecard selection is required
    </mat-error>
    <mat-hint *ngIf="scorecards.length === 0">
      No scorecards available. Please create a scorecard first.
    </mat-hint>
    <mat-hint *ngIf="scorecards.length > 0">
      {{ scorecards.length }} scorecard(s) available
    </mat-hint>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Course/Group Name</mat-label>
    <input matInput formControlName="scGroupName" placeholder="Enter course or group name" title="Course Name" />
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Status</mat-label>
    <mat-select formControlName="status" required>
      <mat-option *ngFor="let status of statusOptions" [value]="status.value">
        {{ status.label }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="matchForm.get('status')?.hasError('required')">
      Status is required
    </mat-error>
  </mat-form-field>

  <!-- Member Lineup Section -->
  <div class="lineup-section">
    <app-match-lineup
      [members]="(members$ | async) ?? []"
      [lineUpsArray]="lineUpsArray"
      [pairingMode]="pairingMode"
      [foursomeIdsTEMP]="matchForm.get('foursomeIdsTEMP')?.value"
      [partnerIdsTEMP]="matchForm.get('partnerIdsTEMP')?.value"
      (removeGroup)="removeGroup($event)"
      (addMembers)="openMemberSelectionDialog()"
      (pairingUpdated)="onPairingUpdated($event)">
    </app-match-lineup>
  </div>

  <mat-form-field appearance="fill">
    <mat-label>Date Played</mat-label>
    <input matInput [matDatepicker]="picker" formControlName="datePlayed" placeholder="Select date played" title="Date Played" />
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    <mat-error *ngIf="matchForm.get('datePlayed')?.hasError('required')">
      Date played is required
    </mat-error>
  </mat-form-field>

  <!-- User field is hidden and automatically set to current user -->
   <!-- TODO  Check the authour value is updated when match is editied -->

  <div class="button-group">
    <button mat-raised-button color="primary" type="submit" [disabled]="(loading$ | async) || matchForm.invalid">
      {{ (loading$ | async) ? 'Updating...' : 'Update Match' }}
    </button>
    <button mat-button type="button" (click)="cancel()">Cancel</button>
  </div>
</form>